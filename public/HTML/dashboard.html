<!DOCTYPE html>
<html>

<head>
  <!--Import Google Icon Font-->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Amatic+SC&display=swap" rel="stylesheet" />

  <!--Import materialize.css-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

  <!-- fontawesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css"
    integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous" />

  <!-- Latest compiled and minified CSS & JS -->
  <link href="https://maxcdn.bootstrapcdn.com/bootswatch/4.0.0/flatly/bootstrap.min.css" rel="stylesheet">

  <!-- custom stylesheets -->
  <link rel="stylesheet" href="../styles/dashboardstyle.css">

  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Expenses</title>
</head>

<!-- Navbar -->
<nav class="nav-extended">
  <div class="nav-wrapper">
    <span id="nav-icon" class="brand-logo"></i>Moolah</span>
    <ul class="right hide-on-med-and-down">
      <!-- <li><a href="profile"><i id="profile-icon" class="large material-icons">account_circle</i></a></li> -->
    </ul>
  </div>

   <!-- Title of Page -->
   <div class="nav-content">
    <span class="title">Dashboard</span>
</div>

  <body>
      <div id="chart-container" class="container">
          <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
          <script type="text/javascript">
            google.charts.load("current", {packages:["corechart"]});
            google.charts.setOnLoadCallback(drawChart);
            function drawChart() {
              var data = google.visualization.arrayToDataTable([['Expenses', 'Spend']]);
              var chart = new google.visualization.PieChart(document.getElementById('chart-container'));
              chart.draw(data, options);
            }
          </script>
          <script type="text/javascript" src="../js/index.js"></script>
          <div id="donutchart" style="width: 900px; height: 450px;"></div>
      </div>

      <button class="this-button" onclick="clickButton()">Click to run</button>

<script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
<script class="someScript">
  function clickButton() {

      // Getting the categories data for a user in the sql db where userId is 1
      var userId = [1];
      
      let chartDataArray = [];
      chartDataArray.push(['Expenses', 'Spend']);

      var responseCategory = $.ajax({
          type: "GET",
          url: "api/category/all/" + userId,
      }).then(categories => categories.forEach(category => totalOfExpensesInCategory(category)));

      function totalOfExpensesInCategory(category) {
        var responseExpenses = $.ajax({
          type: "GET",
          url: "api/expense/" + category.id,
        }).then(expenses => putExpenseTotalsOnChart(category, expenses));
      };
      
      function putExpenseTotalsOnChart(category, expenses) {
        var total = 0;
        expenses.forEach(expense => total = total + parseFloat(expense.amount));
        chartDataArray.push([category.name, total]);
        redrawChart(chartDataArray);
      };

      function redrawChart(array) {
        var data = google.visualization.arrayToDataTable(array);
          var options = {
            title: 'Total Spending',
            pieHole: 0.5
          };
          var chart = new google.visualization.PieChart(document.getElementById('chart-container'));
          chart.draw(data, options);
      };
  };
</script>
 
  <!-- Footer -->
  <footer class="page-footer" id="footer-body">
      <div class="container">
      </div>
      <div class="footer-copyright">
          <div class="container">
          Â© 2019 Copyright. All rights reserved.
          </div>
      </div>
  </footer>

    <!--JavaScript at end of body for optimized loading-->
    <script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="../js/materialize.min.js"></script>
    <script type="text/javascript" src="../js/index.js"></script>
  </body>
</html>